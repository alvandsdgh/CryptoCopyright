{"ast":null,"code":"import _slicedToArray from \"/Users/alvandsadeghi/Desktop/Projects/Final CryptoCopyright/Crypto-Copyright/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/alvandsadeghi/Desktop/Projects/Final CryptoCopyright/Crypto-Copyright/src/Components/Auth/Register.jsx\";\nimport React, { Component } from \"react\";\nimport MuiThemeProvider from \"material-ui/styles/MuiThemeProvider\";\nimport RaisedButton from \"material-ui/RaisedButton\";\nimport TextField from \"material-ui/TextField\";\nimport { connect } from \"react-redux\";\nimport { getItem, addItem } from \"../../utils/idb\";\nimport { createWallet } from \"../../Actions/walletGeneration\";\nimport { login_out } from \"../../Actions/Authentication\";\nimport { updateAccount } from \"../../Actions/Account\";\nimport { keyString256, aesEncrypt } from \"../../utils/creepto\";\nimport { run } from \"../../BlockchainLogic/Faucet\";\nimport \"./Login.css\";\nconst style = {\n  margin: 15\n};\n\nclass Register extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      username: \"\",\n      password: \"\",\n      passwordMatch: \"\",\n      email: \"\",\n      error: null,\n      loading: false,\n      mnemonic: \"\",\n      avatar: \"\"\n    };\n\n    this.handleClick = async () => {\n      let _this$state = this.state,\n          password = _this$state.password,\n          username = _this$state.username,\n          email = _this$state.email,\n          passwordMatch = _this$state.passwordMatch;\n\n      if (password && username && email && passwordMatch) {\n        if (passwordMatch === password) {\n          if (username.length > 3) {\n            let exsitedAccount = await getItem(\"accountInfo\");\n            let existedLoggedIn = await getItem(\"loggedIn\");\n\n            if (existedLoggedIn === undefined && exsitedAccount === undefined) {\n              this.setState({\n                loading: true\n              });\n              let avatarAPI = await fetch(\"https://explorer-testnet.mvs.org/api/avatar/\".concat(username));\n              let avatarInfo = await avatarAPI.json();\n\n              if ((await avatarInfo.result) === null) {\n                try {\n                  const _ref = await run(username),\n                        _ref2 = _slicedToArray(_ref, 2),\n                        mnemonic = _ref2[0],\n                        avatar = _ref2[1];\n\n                  this.setState({\n                    avatar,\n                    mnemonic\n                  });\n                } catch (err) {\n                  this.setState({\n                    error: err.message,\n                    loading: false\n                  });\n                  return false;\n                }\n\n                let passHash = keyString256(password);\n                const key = passHash.key;\n                const salt = passHash.salt;\n                let encryptedHash = aesEncrypt(key, this.state.mnemonic);\n                let secret = {\n                  avatar: this.state.avatar,\n                  salt: salt,\n                  walletInfo: encryptedHash\n                };\n                await addItem([\"accountInfo\", \"loggedIn\", \"mnemonic\"], [secret, true, this.state.mnemonic]);\n                this.props.login_out(true);\n                this.props.updateAccount(secret);\n                this.props.createWallet(this.state.mnemonic, this.state.avatar);\n                this.setState({\n                  loading: false\n                });\n              } else {\n                this.setState({\n                  error: \"The chosen username is taken, please try another name.\",\n                  loading: false\n                });\n              }\n            } else {\n              this.setState({\n                error: \"Account already existed.\"\n              });\n            }\n          } else {\n            this.setState({\n              error: \"Username must be at least 3 charaters.\"\n            });\n          }\n        } else {\n          this.setState({\n            error: \"Your password did not match.\"\n          });\n        }\n      } else {\n        this.setState({\n          error: \"All fields are mandatory.\"\n        });\n      }\n    };\n  }\n\n  componentWillUnmount() {\n    this.setState({\n      loading: false\n    });\n  }\n\n  render() {\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-2 col-sm-3 col-md-4 col-lg-4 col-xl-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }, \" \"), React.createElement(\"div\", {\n      className: \"col-8 col-sm-6 col-md-4 col-lg-4 col-xl-4 logo-text-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-center company-logo-section\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"company-logo\",\n      src: require(\"../../Assets/Logo/crypto-copyright.png\"),\n      alt: \"company-logo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-center mt-2 text-animation\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, React.createElement(MuiThemeProvider, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, React.createElement(TextField, {\n      id: \"username\",\n      hintText: \"Enter your digital identity\",\n      floatingLabelText: \"Digital Identity\",\n      onFocus: e => this.setState({\n        error: null\n      }),\n      onChange: e => this.setState({\n        username: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }), React.createElement(TextField, {\n      id: \"email\",\n      type: \"email\",\n      hintText: \"Enter your email\",\n      floatingLabelText: \"Email\",\n      onFocus: e => this.setState({\n        error: null\n      }),\n      onChange: e => this.setState({\n        email: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }), React.createElement(TextField, {\n      id: \"password\",\n      type: \"password\",\n      hintText: \"Enter your Password\",\n      floatingLabelText: \"Password\",\n      onFocus: e => this.setState({\n        error: null\n      }),\n      onChange: e => {\n        this.setState({\n          password: e.target.value\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }), React.createElement(TextField, {\n      id: \"passwordMatch\",\n      type: \"password\",\n      hintText: \"Re-Enter your Password\",\n      floatingLabelText: \"Password Again\",\n      onFocus: e => this.setState({\n        error: null\n      }),\n      onChange: e => {\n        this.setState({\n          passwordMatch: e.target.value\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }), this.state.error ? React.createElement(\"span\", {\n      className: \"error\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, this.state.error) : \"\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }), React.createElement(RaisedButton, {\n      disabled: this.state.password && this.state.email && this.state.username && !this.state.loading ? false : true,\n      label: this.state.loading ? \"Talking to Metaverse...\" : \"Register\",\n      variant: \"contained\",\n      primary: true,\n      style: style,\n      onClick: this.handleClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    })))))))), React.createElement(\"div\", {\n      className: \"col-2 col-sm-3 col-md-4 col-lg-4 col-xl-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nconst mapStateToProps = () => ({});\n\nexport default connect(mapStateToProps, {\n  createWallet,\n  updateAccount,\n  login_out\n})(Register);","map":{"version":3,"sources":["/Users/alvandsadeghi/Desktop/Projects/Final CryptoCopyright/Crypto-Copyright/src/Components/Auth/Register.jsx"],"names":["React","Component","MuiThemeProvider","RaisedButton","TextField","connect","getItem","addItem","createWallet","login_out","updateAccount","keyString256","aesEncrypt","run","style","margin","Register","state","username","password","passwordMatch","email","error","loading","mnemonic","avatar","handleClick","length","exsitedAccount","existedLoggedIn","undefined","setState","avatarAPI","fetch","avatarInfo","json","result","err","message","passHash","key","salt","encryptedHash","secret","walletInfo","props","componentWillUnmount","render","require","e","target","value","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport MuiThemeProvider from \"material-ui/styles/MuiThemeProvider\";\nimport RaisedButton from \"material-ui/RaisedButton\";\nimport TextField from \"material-ui/TextField\";\nimport { connect } from \"react-redux\";\nimport { getItem, addItem } from \"../../utils/idb\";\nimport { createWallet } from \"../../Actions/walletGeneration\";\nimport { login_out } from \"../../Actions/Authentication\";\nimport { updateAccount } from \"../../Actions/Account\";\nimport { keyString256, aesEncrypt } from \"../../utils/creepto\";\nimport { run } from \"../../BlockchainLogic/Faucet\";\n\nimport \"./Login.css\";\n\nconst style = {\n  margin: 15\n};\n\nclass Register extends Component {\n  state = {\n    username: \"\",\n    password: \"\",\n    passwordMatch: \"\",\n    email: \"\",\n    error: null,\n    loading: false,\n    mnemonic: \"\",\n    avatar: \"\"\n  };\n\n  handleClick = async () => {\n    let { password, username, email, passwordMatch } = this.state;\n    if (password && username && email && passwordMatch) {\n      if (passwordMatch === password) {\n        if (username.length > 3) {\n          let exsitedAccount = await getItem(\"accountInfo\");\n          let existedLoggedIn = await getItem(\"loggedIn\");\n\n          if (existedLoggedIn === undefined && exsitedAccount === undefined) {\n            this.setState({ loading: true });\n            let avatarAPI = await fetch(\n              `https://explorer-testnet.mvs.org/api/avatar/${username}`\n            );\n\n            let avatarInfo = await avatarAPI.json();\n            if ((await avatarInfo.result) === null) {\n              try {\n                const [mnemonic, avatar] = await run(username);\n                this.setState({ avatar, mnemonic });\n              } catch (err) {\n                this.setState({ error: err.message, loading: false });\n\n                return false;\n              }\n              let passHash = keyString256(password);\n              const key = passHash.key;\n              const salt = passHash.salt;\n              let encryptedHash = aesEncrypt(key, this.state.mnemonic);\n\n              let secret = {\n                avatar: this.state.avatar,\n                salt: salt,\n                walletInfo: encryptedHash\n              };\n\n              await addItem(\n                [\"accountInfo\", \"loggedIn\", \"mnemonic\"],\n                [secret, true, this.state.mnemonic]\n              );\n              this.props.login_out(true);\n              this.props.updateAccount(secret);\n              this.props.createWallet(this.state.mnemonic, this.state.avatar);\n              this.setState({ loading: false });\n            } else {\n              this.setState({\n                error: \"The chosen username is taken, please try another name.\",\n                loading: false\n              });\n            }\n            \n          } else {\n            this.setState({ error: \"Account already existed.\" });\n          }\n        } else {\n          this.setState({ error: \"Username must be at least 3 charaters.\" });\n        }\n      } else {\n        this.setState({ error: \"Your password did not match.\" });\n      }\n    } else {\n      this.setState({ error: \"All fields are mandatory.\" });\n    }\n  };\n\n  componentWillUnmount() {\n    this.setState({ loading: false });\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className=\"container-fluid\">\n          <div className=\"row\">\n            <div className=\"col-2 col-sm-3 col-md-4 col-lg-4 col-xl-4\"> </div>\n            <div className=\"col-8 col-sm-6 col-md-4 col-lg-4 col-xl-4 logo-text-container\">\n              <div className=\"row\">\n                <div className=\"col\">\n                  <div className=\"text-center company-logo-section\">\n                    <img\n                      className=\"company-logo\"\n                      src={require(\"../../Assets/Logo/crypto-copyright.png\")}\n                      alt=\"company-logo\"\n                    />\n                  </div>\n                </div>\n              </div>\n              <div className=\"row\">\n                <div className=\"col\">\n                  <div className=\"text-center mt-2 text-animation\">\n                    <div>\n                      <MuiThemeProvider>\n                        <div>\n                          <TextField\n                            id=\"username\"\n                            hintText=\"Enter your digital identity\"\n                            floatingLabelText=\"Digital Identity\"\n                            onFocus={e => this.setState({ error: null })}\n                            onChange={e =>\n                              this.setState({ username: e.target.value })\n                            }\n                          />\n                          <br />\n                          <TextField\n                            id=\"email\"\n                            type=\"email\"\n                            hintText=\"Enter your email\"\n                            floatingLabelText=\"Email\"\n                            onFocus={e => this.setState({ error: null })}\n                            onChange={e =>\n                              this.setState({ email: e.target.value })\n                            }\n                          />\n                          <br />\n                          <TextField\n                            id=\"password\"\n                            type=\"password\"\n                            hintText=\"Enter your Password\"\n                            floatingLabelText=\"Password\"\n                            onFocus={e => this.setState({ error: null })}\n                            onChange={e => {\n                              this.setState({ password: e.target.value });\n                            }}\n                          />\n                          <br />\n                          <TextField\n                            id=\"passwordMatch\"\n                            type=\"password\"\n                            hintText=\"Re-Enter your Password\"\n                            floatingLabelText=\"Password Again\"\n                            onFocus={e => this.setState({ error: null })}\n                            onChange={e => {\n                              this.setState({ passwordMatch: e.target.value });\n                            }}\n                          />\n                          <br />\n                          {this.state.error ? (\n                            <span className=\"error\">{this.state.error}</span>\n                          ) : (\n                            \"\"\n                          )}\n                          <br />\n                          <RaisedButton\n                            disabled={\n                              this.state.password &&\n                              this.state.email &&\n                              this.state.username &&\n                              !this.state.loading\n                                ? false\n                                : true\n                            }\n                            label={\n                              this.state.loading\n                                ? \"Talking to Metaverse...\"\n                                : \"Register\"\n                            }\n                            variant=\"contained\"\n                            primary={true}\n                            style={style}\n                            onClick={this.handleClick}\n                          />\n                        </div>\n                      </MuiThemeProvider>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"col-2 col-sm-3 col-md-4 col-lg-4 col-xl-4\"></div>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nconst mapStateToProps = () => ({});\n\nexport default connect(mapStateToProps, {\n  createWallet,\n  updateAccount,\n  login_out\n})(Register);\n"]},"metadata":{},"sourceType":"module"}